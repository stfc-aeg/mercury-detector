<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>ODIN Server</title>

        <!-- Bootstrap -->
        <link href="js/bootstrap-5.1.1-dist/css/bootstrap.min.css" rel="stylesheet">

        <link href="js/fontawesome-free-5.15.1-web/css/all.min.css" rel="stylesheet">

        <link href="css/bootstrap-switch-4.0.0-alpha.1-dist/bootstrap-switch.min.css" rel="stylesheet">

        <link href="css/carrier.css" rel="stylesheet">
        <link href="css/command-sequencer.css" rel="stylesheet">

        <div id="global-nav"></div>

    </head>
    <body>

        <h1 class="text-center">MERCURY Carrier Control</h1>

                <ul class="nav nav-tabs" role="tablist">
                <!-- <ul class="nav nav-pills" role="tablist"> -->
                    <li class="nav-item" role="presentation"><a class="nav-link" aria-selected="False"          data-bs-toggle="tab" type="button" role="tab" aria-controls="home" data-bs-target="#home">Sequencer</a></li>  
                    <li class="nav-item" role="presentation"><a class="nav-link active" aria-selected="True"    data-bs-toggle="tab" type="button" role="tab" aria-controls="pcbcontrol" data-bs-target="#pcbcontrol">PCB Control</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" aria-selected="False"          data-bs-toggle="tab" type="button" role="tab" aria-controls="about" data-bs-target="#about">About</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" aria-selected="False"          data-bs-toggle="tab" type="button" role="tab" aria-controls="contact" data-bs-target="#contact">Contact</a></li>
                </ul>


        <div class="tab-content">
            <div class="tab-pane fade" id="home" role="tabpanel">
                <h2 class="text-center">Sequencer</h2>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col"></div>
                        <div class="col-md-8">
                            <div class="row contflex">
                                <h4>Log Messages</h4>
                                <pre class="pre-scrollable" id="command-sequencer-log-messages"></pre>
                            </div>
                            <div class="row contflex">
                                <div class="col-md-12" id="command-sequencer-alerts-row"></div>
                            </div>
                            <div class="row contflex">
                                <div class="col-md-4"></div>
                                <div class="col-md-4" id="command-sequencer-control-buttons"></div>
                            </div>
                            <div class="row contflex">
                                <div class="col-md-1"></div>
                                <div class="col-md-10" id="command-sequencer-sequence-modules-layout"></div>
                                <div class="col-md-1"></div>
                            </div>
                        </div>
                        <div class="col"></div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade show active" id="pcbcontrol" role="tabpanel">
                <h2 class="text-center">MERCURY PCB Control</h2>

                <div class="container-fluid">
                    <div class="row contflex row-cols-1 row-cols-md-2 g-4">

                        <div class="col-xxl-2 col-xl-5 col-lg-5 col-md-5 col-sm-11 card">
                            <div class="row">
                                <p class="lead text-center">System Temperatures</p>
                            </div>
                            <div class="row contflex">
                                <div class="col-md-11">
                                    <table class="table table-striped" style="width=100%">
                                        <thead>
                                            <tr>
                                                <th>Sensor</th>
                                                <th>Temp (C)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Zynq PS</td>
                                                <td><span id="temp-zynqps">&nbsp;</span></td>
                                            </tr>
                                            <tr>
                                                <td>Ambient</td>
                                                <td><span id="temp-ambient">&nbsp;</span></td>
                                            </tr>
                                            <tr>
                                                <td>FireFly 1</td>
                                                <td><span id="temp-firefly1">&nbsp;</span></td>
                                            </tr>
                                            <tr>
                                                <td>FireFly 2</td>
                                                <td><span id="temp-firefly2">&nbsp;</span></td>
                                            </tr>
                                            <tr>
                                                <td>PT100</td>
                                                <td><span id="temp-pt100">&nbsp;</span></td>
                                            </tr>
                                            <tr>
                                                <td>ASIC TEMP1</td>
                                                <td><span id="temp-asic-1">&nbsp;</span></td>
                                            </tr>
                                            <tr>
                                                <td>ASIC TEMP2</td>
                                                <td><span id="temp-asic-2">&nbsp;</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> <!-- col-md-2 -->

                        <div class="col-xxl-2 col-xl-5 col-lg-5 col-md-5 col-sm-11 card">
                            <div class="row">
                                <p class="lead text-center">ASIC Control</p>
                            </div> <!-- row -->
			    <div class="row contflex">
                                <div class="card mb-3 text-center">
				    <div class="card-header">
					VCAL Control
				    </div>
				    <div class="card-body">
		                        <div class="row contflex">
                                    <p>VCAL Voltage: <span id="vcal-voltage">&nbsp;</span>v</p>
                                    <div class="input-group mb-3">
                                        <span class="input-group-text">VCAL (V)</span>
                                        <input type="number" class="form-control" id="vcal-input"/>
                                        <button class="btn btn-outline-secondary" type="button" onclick="change_vcal()">Update</button>
                                    </div>
                                    <!-- <p><input type="button" value="Update" id="vcal-submit" onclick="change_vcal()"/></p> -->

					</div>
				    </div>
				</div>
                                <div class="card mb-3 text-center">
				    <div class="card-header">
					ASIC Mode
				    </div>
				    <div class="card-body">
					<div class="row contflex">
						<div class="col">
							<button type="button" class="btn btn-primary"  onclick="run_vreg_cycle()">Power Cycle Regulators</button>
						</div>
						<div class="col">
							<button type="button" class="btn btn-primary"  onclick="change_asic_mode('global')">Enable Global Mode</button>
						</div>
						<div class="col">
						    <p>Reset State: </p>
						    <span id="asic-rst-state">&nbsp;</span>
						</div>
						<div class="col">
						    <p>Regulator Enable State: </p>
						    <span id="vreg-en-state">&nbsp;</span>
						</div>
					</div>
				    </div>
                                </div>
                                <div class="card w-75 text-center">
				    <div class="card-header">
					Sync Control
				    </div>
				    <div class="card-body">
					<div class="row contflex">
					    <div class="col">
						<p>Sync Source: </p>
						<div class="btn-group-vertical" role="group" aria-label="Basic radio toggle button group" id="sync_aux_radio">
						    <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" onclick="change_sync_sel_aux(1)">
						    <label class="btn btn-outline-primary" for="btnradio1">Aux</label>

						    <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" onclick="change_sync_sel_aux(0)" checked>
						    <label class="btn btn-outline-primary" for="btnradio2">Zynq</label>
						</div>
					    </div>
					    <div class="col">
						<p>Sync State: </p>
						<span id="asic-sync-state">&nbsp;</span>
					    </div>
					</div>
				    </div>
                                </div>
					<div class="toast" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true">
					  <div class="toast-body">
					    WARNING: Regulators disabled due to critical temperature. Correct cooling and cycle regulators to recover.
					    <div class="mt-2 pt-2 border-top">
					      <button type="button" class="btn btn-primary btn-sm" onclick="run_vreg_cycle()" data-bs-dismiss="toast">Cycle Regulators</button>
					      <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="toast">Close</button>
					    </div>
					  </div>
					</div>
			    </div> <!-- row -->
                        </div> <!-- vol-md-2 -->

                        <div class="col-xxl-7 col-xl-11 col-lg-11 col-md-11 col-sm-11 card">
                            <div class="row">
                                <p class="lead text-center">System Power Rails</p>
                            </div>
                            <div class="row contflex">
                                <div class="col-lg-5 col-md-12 col-sm-12">
                                    <table class="table table-striped"style="width=100%">
                                        <thead>
                                            <tr>
                                                <th>Rail</th>
                                                <th>Power (W)</th>
                                                <th>Pre-Regulator Voltage (V)</th>
                                                <th>Current (A)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Analogue</td>
                                                <td><span id="psu-analogue-pwr"></span></td>
                                                <td><span id="psu-analogue-vol"></span></td>
                                                <td><span id="psu-analogue-cur"></span></td>
                                            </tr>
                                            <tr>
                                                <td>Digital</td>
                                                <td><span id="psu-dig-pwr"></span></td>
                                                <td><span id="psu-dig-vol"></span></td>
                                                <td><span id="psu-dig-cur"></span></td>
                                            </tr>
                                            <tr>
                                                <td>Digital Control</td>
                                                <td><span id="psu-dig-ctrl-pwr"></span></td>
                                                <td><span id="psu-dig-ctrl-vol"></span></td>
                                                <td><span id="psu-dig-ctrl-cur"></span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div> <!-- col -->
                                <div class="col-lg-5 col-md-12 col-sm-12">
                                    <div class="row">
                                        <h6>Pre-Regulator Voltage</h6>
                                        <canvas id="voltage-chart"></canvas>
                                    </div>
                                    <div class="row">
                                        <h6>Rail Current</h6>
                                        <canvas id="current-chart"></canvas>
                                    </div>
                                </div> <!-- col -->
                            </div> <!-- row -->
                        </div> <!-- col-md-4 -->

                    <!-- </div> -->

                    <!-- <div class="row contflex"> -->
                        <div class="col-md-12">
                            <div class="row contflex">
                                <h3 class="text-center">FireFly Channel Control</h3>
                            </div>
                            <div class="row contflex">
                                <div class="col-xl-5 col-lg-11 col-md-11 col-sm-11 card">
                                    <div id='ff1_chtable'></div>
                                </div> <!-- col-md-6 -->

                                <div class="col-xl-5 col-lg-11 col-md-11 col-sm-11 card">
                                    <div id='ff2_chtable'></div>
                                </div> <!-- col-md-6 -->
                            </div> <!-- row -->
                        </div> <!-- col-md-11 -->
                    </div> <!-- row -->

                </div><!-- container fluid-container -->
            </div>

            <div class="tab-pane fade" id="about" role="tabpanel">
                <h2 class="text-center">About</h2>
                <div class="container-fluid">
                    <h3 class="text-center">API Information</h3>
                    <p>API version is:&nbsp;<span id="api-version">&nbsp;</span></p>
                    <p>Registered API adapters:&nbsp;<span id="api-adapters">&nbsp;</span></p>
                </div>

            </div>

            <div class="tab-pane fade" id="contact" role="tabpanel">
                Contact
            </div>
        </div>

        <script src="js/global-nav.js"></script>
        <script>
            var nav = get_navbar('index.html');
            var demo = document.getElementById('global-nav'); // target element.
            demo.insertAdjacentHTML('beforeend', nav);
        </script>

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <!-- <script src="js/jquery-2.2.3.min.js"></script> -->
        <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>

        <!-- Include all compiled plugins (below), or include individual files as needed -->

        <script src="js/bootstrap-5.1.1-dist/js/bootstrap.min.js"></script>

        <script src="js/bootstrap-switch-4.0.0-alpha.1-dist/bootstrap-switch.min.js"></script>

        <script src="js/moment.js"></script>

        <!-- <script src="js/chart.js-3.5.1/chart.min.js"></script> -->
        <script src="js/chart.js-2.9.3/Chart.min.js"></script>

        <script src="js/carrier.js"></script>
        <script src="js/odin_control.js"></script>
        <script src="js/command_sequencer.js"></script>

    </body>
</html>
